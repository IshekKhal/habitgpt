{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"exportNames":["*"],"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":100,"column":0,"index":3568}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"exportNames":["*"],"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":100,"column":0,"index":3568}}],"key":"8I802z/QkQYw0PV6ZCqhBNDwn0Q="}},{"name":"./utils","data":{"asyncType":null,"exportNames":["*"],"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":34,"index":34}}],"key":"FH4oXkS7WdR5kG0v+Eku8TWcu80="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.streamedQuery = streamedQuery;\n  var _asyncToGenerator2 = _interopRequireDefault(require(_dependencyMap[1], \"@babel/runtime/helpers/asyncToGenerator\"));\n  var _utils = require(_dependencyMap[2], \"./utils\");\n  function _asyncIterator(r) { var n, t, o, e = 2; for (\"undefined\" != typeof Symbol && (t = Symbol.asyncIterator, o = Symbol.iterator); e--;) { if (t && null != (n = r[t])) return n.call(r); if (o && null != (n = r[o])) return new AsyncFromSyncIterator(n.call(r)); t = \"@@asyncIterator\", o = \"@@iterator\"; } throw new TypeError(\"Object is not async iterable\"); }\n  function AsyncFromSyncIterator(r) { function AsyncFromSyncIteratorContinuation(r) { if (Object(r) !== r) return Promise.reject(new TypeError(r + \" is not an object.\")); var n = r.done; return Promise.resolve(r.value).then(function (r) { return { value: r, done: n }; }); } return AsyncFromSyncIterator = function (r) { this.s = r, this.n = r.next; }, AsyncFromSyncIterator.prototype = { s: null, n: null, next: function () { return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments)); }, return: function (r) { var n = this.s.return; return void 0 === n ? Promise.resolve({ value: r, done: !0 }) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments)); }, throw: function (r) { var n = this.s.return; return void 0 === n ? Promise.reject(r) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments)); } }, new AsyncFromSyncIterator(r); }\n  /**\n   * This is a helper function to create a query function that streams data from an AsyncIterable.\n   * Data will be an Array of all the chunks received.\n   * The query will be in a 'pending' state until the first chunk of data is received, but will go to 'success' after that.\n   * The query will stay in fetchStatus 'fetching' until the stream ends.\n   * @param queryFn - The function that returns an AsyncIterable to stream data from.\n   * @param refetchMode - Defines how re-fetches are handled.\n   * Defaults to `'reset'`, erases all data and puts the query back into `pending` state.\n   * Set to `'append'` to append new data to the existing data.\n   * Set to `'replace'` to write all data to the cache once the stream ends.\n   * @param reducer - A function to reduce the streamed chunks into the final data.\n   * Defaults to a function that appends chunks to the end of the array.\n   * @param initialValue - Initial value to be used while the first chunk is being fetched, and returned if the stream yields no values.\n   */\n  function streamedQuery(_ref) {\n    var streamFn = _ref.streamFn,\n      _ref$refetchMode = _ref.refetchMode,\n      refetchMode = _ref$refetchMode === void 0 ? 'reset' : _ref$refetchMode,\n      _ref$reducer = _ref.reducer,\n      reducer = _ref$reducer === void 0 ? (items, chunk) => (0, _utils.addToEnd)(items, chunk) : _ref$reducer,\n      _ref$initialValue = _ref.initialValue,\n      initialValue = _ref$initialValue === void 0 ? [] : _ref$initialValue;\n    return /*#__PURE__*/function () {\n      var _ref2 = (0, _asyncToGenerator2.default)(function* (context) {\n        var query = context.client.getQueryCache().find({\n          queryKey: context.queryKey,\n          exact: true\n        });\n        var isRefetch = !!query && query.state.data !== undefined;\n        if (isRefetch && refetchMode === 'reset') {\n          query.setState({\n            status: 'pending',\n            data: undefined,\n            error: null,\n            fetchStatus: 'fetching'\n          });\n        }\n        var result = initialValue;\n        var stream = yield streamFn(context);\n        var _iteratorAbruptCompletion = false;\n        var _didIteratorError = false;\n        var _iteratorError;\n        try {\n          var _loop = function* () {\n            var chunk = _step.value;\n            {\n              if (context.signal.aborted) {\n                return 1; // break\n              }\n\n              // don't append to the cache directly when replace-refetching\n              if (!isRefetch || refetchMode !== 'replace') {\n                context.client.setQueryData(context.queryKey, prev => reducer(prev === undefined ? initialValue : prev, chunk));\n              }\n              result = reducer(result, chunk);\n            }\n          };\n          for (var _iterator = _asyncIterator(stream), _step; _iteratorAbruptCompletion = !(_step = yield _iterator.next()).done; _iteratorAbruptCompletion = false) {\n            if (yield* _loop()) break;\n          }\n\n          // finalize result: replace-refetching needs to write to the cache\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (_iteratorAbruptCompletion && _iterator.return != null) {\n              yield _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n        if (isRefetch && refetchMode === 'replace' && !context.signal.aborted) {\n          context.client.setQueryData(context.queryKey, result);\n        }\n        return context.client.getQueryData(context.queryKey) ?? initialValue;\n      });\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n  }\n});","lineCount":97,"map":[[8,2,1,0],[8,6,1,0,"_utils"],[8,12,1,0],[8,15,1,0,"require"],[8,22,1,0],[8,23,1,0,"_dependencyMap"],[8,37,1,0],[9,2,1,34],[9,11,1,34,"_asyncIterator"],[9,26,1,34,"r"],[9,27,1,34],[9,35,1,34,"n"],[9,36,1,34],[9,38,1,34,"t"],[9,39,1,34],[9,41,1,34,"o"],[9,42,1,34],[9,44,1,34,"e"],[9,45,1,34],[9,78,1,34,"Symbol"],[9,84,1,34],[9,89,1,34,"t"],[9,90,1,34],[9,93,1,34,"Symbol"],[9,99,1,34],[9,100,1,34,"asyncIterator"],[9,113,1,34],[9,115,1,34,"o"],[9,116,1,34],[9,119,1,34,"Symbol"],[9,125,1,34],[9,126,1,34,"iterator"],[9,134,1,34],[9,137,1,34,"e"],[9,138,1,34],[9,149,1,34,"t"],[9,150,1,34],[9,163,1,34,"n"],[9,164,1,34],[9,167,1,34,"r"],[9,168,1,34],[9,169,1,34,"t"],[9,170,1,34],[9,181,1,34,"n"],[9,182,1,34],[9,183,1,34,"call"],[9,187,1,34],[9,188,1,34,"r"],[9,189,1,34],[9,196,1,34,"o"],[9,197,1,34],[9,210,1,34,"n"],[9,211,1,34],[9,214,1,34,"r"],[9,215,1,34],[9,216,1,34,"o"],[9,217,1,34],[9,232,1,34,"AsyncFromSyncIterator"],[9,253,1,34],[9,254,1,34,"n"],[9,255,1,34],[9,256,1,34,"call"],[9,260,1,34],[9,261,1,34,"r"],[9,262,1,34],[9,266,1,34,"t"],[9,267,1,34],[9,289,1,34,"o"],[9,290,1,34],[9,319,1,34,"TypeError"],[9,328,1,34],[10,2,1,34],[10,11,1,34,"AsyncFromSyncIterator"],[10,33,1,34,"r"],[10,34,1,34],[10,47,1,34,"AsyncFromSyncIteratorContinuation"],[10,81,1,34,"r"],[10,82,1,34],[10,90,1,34,"Object"],[10,96,1,34],[10,97,1,34,"r"],[10,98,1,34],[10,104,1,34,"r"],[10,105,1,34],[10,114,1,34,"Promise"],[10,121,1,34],[10,122,1,34,"reject"],[10,128,1,34],[10,133,1,34,"TypeError"],[10,142,1,34],[10,143,1,34,"r"],[10,144,1,34],[10,175,1,34,"n"],[10,176,1,34],[10,179,1,34,"r"],[10,180,1,34],[10,181,1,34,"done"],[10,185,1,34],[10,194,1,34,"Promise"],[10,201,1,34],[10,202,1,34,"resolve"],[10,209,1,34],[10,210,1,34,"r"],[10,211,1,34],[10,212,1,34,"value"],[10,217,1,34],[10,219,1,34,"then"],[10,223,1,34],[10,234,1,34,"r"],[10,235,1,34],[10,248,1,34,"value"],[10,253,1,34],[10,255,1,34,"r"],[10,256,1,34],[10,258,1,34,"done"],[10,262,1,34],[10,264,1,34,"n"],[10,265,1,34],[10,282,1,34,"AsyncFromSyncIterator"],[10,303,1,34],[10,315,1,34,"AsyncFromSyncIterator"],[10,316,1,34,"r"],[10,317,1,34],[10,326,1,34,"s"],[10,327,1,34],[10,330,1,34,"r"],[10,331,1,34],[10,338,1,34,"n"],[10,339,1,34],[10,342,1,34,"r"],[10,343,1,34],[10,344,1,34,"next"],[10,348,1,34],[10,353,1,34,"AsyncFromSyncIterator"],[10,374,1,34],[10,375,1,34,"prototype"],[10,384,1,34],[10,389,1,34,"s"],[10,390,1,34],[10,398,1,34,"n"],[10,399,1,34],[10,407,1,34,"next"],[10,411,1,34],[10,422,1,34,"next"],[10,423,1,34],[10,434,1,34,"AsyncFromSyncIteratorContinuation"],[10,467,1,34],[10,473,1,34,"n"],[10,474,1,34],[10,475,1,34,"apply"],[10,480,1,34],[10,486,1,34,"s"],[10,487,1,34],[10,489,1,34,"arguments"],[10,498,1,34],[10,505,1,34,"return"],[10,511,1,34],[10,522,1,34,"return"],[10,523,1,34,"r"],[10,524,1,34],[10,532,1,34,"n"],[10,533,1,34],[10,541,1,34,"s"],[10,542,1,34],[10,543,1,34,"return"],[10,549,1,34],[10,569,1,34,"n"],[10,570,1,34],[10,573,1,34,"Promise"],[10,580,1,34],[10,581,1,34,"resolve"],[10,588,1,34],[10,591,1,34,"value"],[10,596,1,34],[10,598,1,34,"r"],[10,599,1,34],[10,601,1,34,"done"],[10,605,1,34],[10,615,1,34,"AsyncFromSyncIteratorContinuation"],[10,648,1,34],[10,649,1,34,"n"],[10,650,1,34],[10,651,1,34,"apply"],[10,656,1,34],[10,662,1,34,"s"],[10,663,1,34],[10,665,1,34,"arguments"],[10,674,1,34],[10,681,1,34,"throw"],[10,686,1,34],[10,697,1,34,"throw"],[10,698,1,34,"r"],[10,699,1,34],[10,707,1,34,"n"],[10,708,1,34],[10,716,1,34,"s"],[10,717,1,34],[10,718,1,34,"return"],[10,724,1,34],[10,744,1,34,"n"],[10,745,1,34],[10,748,1,34,"Promise"],[10,755,1,34],[10,756,1,34,"reject"],[10,762,1,34],[10,763,1,34,"r"],[10,764,1,34],[10,768,1,34,"AsyncFromSyncIteratorContinuation"],[10,801,1,34],[10,802,1,34,"n"],[10,803,1,34],[10,804,1,34,"apply"],[10,809,1,34],[10,815,1,34,"s"],[10,816,1,34],[10,818,1,34,"arguments"],[10,827,1,34],[10,840,1,34,"AsyncFromSyncIterator"],[10,861,1,34],[10,862,1,34,"r"],[10,863,1,34],[11,2,32,0],[12,0,33,0],[13,0,34,0],[14,0,35,0],[15,0,36,0],[16,0,37,0],[17,0,38,0],[18,0,39,0],[19,0,40,0],[20,0,41,0],[21,0,42,0],[22,0,43,0],[23,0,44,0],[24,0,45,0],[25,2,46,7],[25,11,46,16,"streamedQuery"],[25,24,46,29,"streamedQuery"],[25,25,46,29,"_ref"],[25,29,46,29],[25,31,59,2],[26,4,59,2],[26,8,51,2,"streamFn"],[26,16,51,10],[26,19,51,10,"_ref"],[26,23,51,10],[26,24,51,2,"streamFn"],[26,32,51,10],[27,6,51,10,"_ref$refetchMode"],[27,22,51,10],[27,25,51,10,"_ref"],[27,29,51,10],[27,30,52,2,"refetchMode"],[27,41,52,13],[28,6,52,2,"refetchMode"],[28,17,52,13],[28,20,52,13,"_ref$refetchMode"],[28,36,52,13],[28,50,52,16],[28,57,52,23],[28,60,52,23,"_ref$refetchMode"],[28,76,52,23],[29,6,52,23,"_ref$reducer"],[29,18,52,23],[29,21,52,23,"_ref"],[29,25,52,23],[29,26,53,2,"reducer"],[29,33,53,9],[30,6,53,2,"reducer"],[30,13,53,9],[30,16,53,9,"_ref$reducer"],[30,28,53,9],[30,42,53,12],[30,43,53,13,"items"],[30,48,53,18],[30,50,53,20,"chunk"],[30,55,53,25],[30,60,54,4],[30,64,54,4,"addToEnd"],[30,79,54,12],[30,81,54,13,"items"],[30,86,54,18],[30,88,54,43,"chunk"],[30,93,54,48],[30,94,54,58],[30,97,54,58,"_ref$reducer"],[30,109,54,58],[31,6,54,58,"_ref$initialValue"],[31,23,54,58],[31,26,54,58,"_ref"],[31,30,54,58],[31,31,55,2,"initialValue"],[31,43,55,14],[32,6,55,2,"initialValue"],[32,18,55,14],[32,21,55,14,"_ref$initialValue"],[32,38,55,14],[32,52,55,17],[32,54,55,19],[32,57,55,19,"_ref$initialValue"],[32,74,55,19],[33,4,60,2],[34,6,60,2],[34,10,60,2,"_ref2"],[34,15,60,2],[34,22,60,2,"_asyncToGenerator2"],[34,40,60,2],[34,41,60,2,"default"],[34,48,60,2],[34,50,60,9],[34,61,60,16,"context"],[34,68,60,23],[34,70,60,28],[35,8,61,4],[35,12,61,10,"query"],[35,17,61,15],[35,20,61,18,"context"],[35,27,61,25],[35,28,61,26,"client"],[35,34,61,32],[35,35,62,7,"getQueryCache"],[35,48,62,20],[35,49,62,21],[35,50,62,22],[35,51,63,7,"find"],[35,55,63,11],[35,56,63,12],[36,10,63,14,"queryKey"],[36,18,63,22],[36,20,63,24,"context"],[36,27,63,31],[36,28,63,32,"queryKey"],[36,36,63,40],[37,10,63,42,"exact"],[37,15,63,47],[37,17,63,49],[38,8,63,54],[38,9,63,55],[38,10,63,56],[39,8,64,4],[39,12,64,10,"isRefetch"],[39,21,64,19],[39,24,64,22],[39,25,64,23],[39,26,64,24,"query"],[39,31,64,29],[39,35,64,33,"query"],[39,40,64,38],[39,41,64,39,"state"],[39,46,64,44],[39,47,64,45,"data"],[39,51,64,49],[39,56,64,54,"undefined"],[39,65,64,63],[40,8,65,4],[40,12,65,8,"isRefetch"],[40,21,65,17],[40,25,65,21,"refetchMode"],[40,36,65,32],[40,41,65,37],[40,48,65,44],[40,50,65,46],[41,10,66,6,"query"],[41,15,66,11],[41,16,66,12,"setState"],[41,24,66,20],[41,25,66,21],[42,12,67,8,"status"],[42,18,67,14],[42,20,67,16],[42,29,67,25],[43,12,68,8,"data"],[43,16,68,12],[43,18,68,14,"undefined"],[43,27,68,23],[44,12,69,8,"error"],[44,17,69,13],[44,19,69,15],[44,23,69,19],[45,12,70,8,"fetchStatus"],[45,23,70,19],[45,25,70,21],[46,10,71,6],[46,11,71,7],[46,12,71,8],[47,8,72,4],[48,8,74,4],[48,12,74,8,"result"],[48,18,74,14],[48,21,74,17,"initialValue"],[48,33,74,29],[49,8,76,4],[49,12,76,10,"stream"],[49,18,76,16],[49,27,76,25,"streamFn"],[49,35,76,33],[49,36,76,34,"context"],[49,43,76,41],[49,44,76,42],[50,8,76,42],[50,12,76,42,"_iteratorAbruptCompletion"],[50,37,76,42],[51,8,76,42],[51,12,76,42,"_didIteratorError"],[51,29,76,42],[52,8,76,42],[52,12,76,42,"_iteratorError"],[52,26,76,42],[53,8,76,42],[54,10,76,42],[54,14,76,42,"_loop"],[54,19,76,42],[54,32,76,42,"_loop"],[54,33,76,42],[54,35,78,38],[55,12,78,38],[55,16,78,21,"chunk"],[55,21,78,26],[55,24,78,26,"_step"],[55,29,78,26],[55,30,78,26,"value"],[55,35,78,26],[56,12,78,26],[57,14,79,6],[57,18,79,10,"context"],[57,25,79,17],[57,26,79,18,"signal"],[57,32,79,24],[57,33,79,25,"aborted"],[57,40,79,32],[57,42,79,34],[58,16,79,34],[59,14,81,6],[61,14,83,6],[62,14,84,6],[62,18,84,10],[62,19,84,11,"isRefetch"],[62,28,84,20],[62,32,84,24,"refetchMode"],[62,43,84,35],[62,48,84,40],[62,57,84,49],[62,59,84,51],[63,16,85,8,"context"],[63,23,85,15],[63,24,85,16,"client"],[63,30,85,22],[63,31,85,23,"setQueryData"],[63,43,85,35],[63,44,85,43,"context"],[63,51,85,50],[63,52,85,51,"queryKey"],[63,60,85,59],[63,62,85,62,"prev"],[63,66,85,66],[63,70,86,10,"reducer"],[63,77,86,17],[63,78,86,18,"prev"],[63,82,86,22],[63,87,86,27,"undefined"],[63,96,86,36],[63,99,86,39,"initialValue"],[63,111,86,51],[63,114,86,54,"prev"],[63,118,86,58],[63,120,86,60,"chunk"],[63,125,86,65],[63,126,87,8],[63,127,87,9],[64,14,88,6],[65,14,89,6,"result"],[65,20,89,12],[65,23,89,15,"reducer"],[65,30,89,22],[65,31,89,23,"result"],[65,37,89,29],[65,39,89,31,"chunk"],[65,44,89,36],[65,45,89,37],[66,12,89,37],[67,10,90,4],[67,11,90,5],[68,10,78,4],[68,19,78,4,"_iterator"],[68,28,78,4],[68,31,78,4,"_asyncIterator"],[68,45,78,4],[68,46,78,30,"stream"],[68,52,78,36],[68,55,78,36,"_step"],[68,60,78,36],[68,62,78,36,"_iteratorAbruptCompletion"],[68,87,78,36],[68,92,78,36,"_step"],[68,97,78,36],[68,106,78,36,"_iterator"],[68,115,78,36],[68,116,78,36,"next"],[68,120,78,36],[68,124,78,36,"done"],[68,128,78,36],[68,130,78,36,"_iteratorAbruptCompletion"],[68,155,78,36],[69,12,78,36],[69,23,78,36,"_loop"],[69,28,78,36],[69,32,80,8],[70,10,80,13],[72,10,92,4],[73,8,92,4],[73,17,92,4,"err"],[73,20,92,4],[74,10,92,4,"_didIteratorError"],[74,27,92,4],[75,10,92,4,"_iteratorError"],[75,24,92,4],[75,27,92,4,"err"],[75,30,92,4],[76,8,92,4],[77,10,92,4],[78,12,92,4],[78,16,92,4,"_iteratorAbruptCompletion"],[78,41,92,4],[78,45,92,4,"_iterator"],[78,54,92,4],[78,55,92,4,"return"],[78,61,92,4],[79,14,92,4],[79,20,92,4,"_iterator"],[79,29,92,4],[79,30,92,4,"return"],[79,36,92,4],[80,12,92,4],[81,10,92,4],[82,12,92,4],[82,16,92,4,"_didIteratorError"],[82,33,92,4],[83,14,92,4],[83,20,92,4,"_iteratorError"],[83,34,92,4],[84,12,92,4],[85,10,92,4],[86,8,92,4],[87,8,93,4],[87,12,93,8,"isRefetch"],[87,21,93,17],[87,25,93,21,"refetchMode"],[87,36,93,32],[87,41,93,37],[87,50,93,46],[87,54,93,50],[87,55,93,51,"context"],[87,62,93,58],[87,63,93,59,"signal"],[87,69,93,65],[87,70,93,66,"aborted"],[87,77,93,73],[87,79,93,75],[88,10,94,6,"context"],[88,17,94,13],[88,18,94,14,"client"],[88,24,94,20],[88,25,94,21,"setQueryData"],[88,37,94,33],[88,38,94,41,"context"],[88,45,94,48],[88,46,94,49,"queryKey"],[88,54,94,57],[88,56,94,59,"result"],[88,62,94,65],[88,63,94,66],[89,8,95,4],[90,8,97,4],[90,15,97,11,"context"],[90,22,97,18],[90,23,97,19,"client"],[90,29,97,25],[90,30,97,26,"getQueryData"],[90,42,97,38],[90,43,97,39,"context"],[90,50,97,46],[90,51,97,47,"queryKey"],[90,59,97,55],[90,60,97,56],[90,64,97,60,"initialValue"],[90,76,97,72],[91,6,98,2],[91,7,98,3],[92,6,98,3],[92,23,98,3,"_x"],[92,25,98,3],[93,8,98,3],[93,15,98,3,"_ref2"],[93,20,98,3],[93,21,98,3,"apply"],[93,26,98,3],[93,33,98,3,"arguments"],[93,42,98,3],[94,6,98,3],[95,4,98,3],[96,2,99,0],[97,0,99,1],[97,3]],"functionMap":{"names":["<global>","streamedQuery","<anonymous>","context.client.setQueryData$argument_1"],"mappings":"AAA;OC6C;YCO;0DDC;SCM;6DCyB;kEDC;GDY;CDC"}},"type":"js/module"}]}